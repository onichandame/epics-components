import { useEffect, useReducer } from 'react'
import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import {
  Grid
} from '@material-ui/core'

import Subject from './RealTimeLineChart'

<Meta title="Chart/Real Time Line Chart" component={Subject}/>

# Real Time Line Chart

A simple dynamic line chart based on [Recharts](http://recharts.org/).

100% of parent width and height is occupied.

## Basic

<Preview>
  <Story name="Basic">
    {
      () => {
        let data = [
          {
            time: '0',
            val1: '10',
            val2: '20'
          },
          {
            time: '2',
            val1: '50',
            val2: '80'
          },
          {
            time: '3',
            val1: '30',
            val2: '40'
          }
        ]
        return (
          <div style={{ height: '450px', display: 'flex' }}>
            <div style={{ height: '450px'}}>
              <Subject label="line chart" data={data} x={'time'} y={['val1', 'val2']} />
            </div>
            <div style={{ height: '250px'}}>
              <Subject label="line chart" data={data} x={'time'} y={['val1', 'val2']} />
            </div>
          </div>
        )
      }
    }
  </Story>
</Preview>

## Dynamic

The animation speed is hard coded to fit the refresh rate higher than 2 per second. When the refresh rate is low, the delay between frames is significant.

<Preview>
  <Story name="Dynamic">
    {
      () => {
        const reducer = (prev) => {
          let data = JSON.parse(JSON.stringify(prev))
          if(!Array.isArray(data)) return []
          if(data.length < 1) {
            data.push({
              x: 0,
              y1: Math.sin(0),
              y2: Math.cos(0),
            })
          } else {
            const latest = data[data.length - 1]
            const x = latest.x + 0.1
            const y1 = Math.sin(x)
            const y2 = Math.cos(x)
            data.push({ x, y1, y2 })
          }
          if(data.length > 2000) {
            data.shift()
          }
          return data
        }
        const [data, update] = useReducer(reducer, [{ x:0, y1:0, y2:1 }])
        useEffect(() => {
          setInterval(update, 500)
        }, [])
        return (
          <div style={{height: '250px'}}>
            <Subject label="real time line chart" data={data} x={'x'} y={['y1', 'y2']} />
          </div>
        )
      }
    }
  </Story>
</Preview>

## API

<Props of={Subject}/>
