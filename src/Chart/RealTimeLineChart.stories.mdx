import { useEffect, useReducer } from 'react'
import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';

import Subject from './RealTimeLineChart'

<Meta title="Chart/Real Time Line Chart" component={Subject}/>

# Real Time Line Chart

A simple dynamic line chart based on [Recharts](http://recharts.org/)

## Basic

<Preview>
  <Story name="Basic">
    {
      () => {
        let data = [
          {
            time: '0',
            val1: '10',
            val2: '20'
          },
          {
            time: '2',
            val1: '50',
            val2: '80'
          },
          {
            time: '3',
            val1: '30',
            val2: '40'
          }
        ]
        return (
          <div style={{display: 'flex', width: '700px', height: '250px'}}>
            <Subject label="line chart" data={data} x={'time'} y={['val1', 'val2']} />
          </div>
        )
      }
    }
  </Story>
</Preview>

## Dynamic

The animation speed is hard coded to fit the refresh rate higher than 2 per second. When the refresh rate is low, the delay between frames is significant.

<Preview>
  <Story name="Dynamic">
    {
      () => {
        const [data, dispatch] = useReducer(() => {
          const num = 1200
          const period = 5000
          const scope = 4 * Math.PI
          const time = new Date().getTime()
          return (
            Array.from(Array(num).keys()).map(value => {
              const coefficient  = 0.0001 * Math.PI
              return ({
                time: new Date().toString(),
                val1: Math.sin(coefficient * (time + 50 * value)),
                val2: Math.cos(coefficient * (time + 50 * value))
              })
            })
          )
        }, [])
        useEffect(() => {
          setInterval(dispatch, 500)
        }, [])
        return (
          <div style={{display: 'flex', width: '700px', height: '250px'}}>
            <Subject label="real time line chart" data={data} x={'time'} y={['val1', 'val2']} />
          </div>
        )
      }
    }
  </Story>
</Preview>

## API

<Props of={Subject}/>
